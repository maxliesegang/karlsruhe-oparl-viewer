---
import Layout from "../layouts/Layout.astro";
import PapersTable from "../components/PapersTable.astro";
import YearLinks from "../components/YearLinks.astro";
import type { Paper } from "../shared/types/paper";
import {
  loadPapers,
  getAllAvailableYears,
  getRelevantYear,
} from "../shared/data";

export async function getStaticPaths() {
  const [allPapers, allYears] = await Promise.all([
    loadPapers(),
    getAllAvailableYears(),
  ]);

  return allYears.map((year) => ({
    params: { year },
    props: {
      papers: allPapers.filter((p) => getRelevantYear(p) === year),
      allYears,
    },
  }));
}

interface Props {
  papers: Paper[];
  allYears: string[];
}

const { year } = Astro.params;
const { papers, allYears } = Astro.props;
---

<Layout>
  <div class="container">
    <h1 class="page-header">Aktualisierte Vorlagen aus dem Jahr {year}</h1>

    <YearLinks allYears={allYears} currentYear={year} />

    <div class="content-section" data-pagefind-ignore>
      <PapersTable papers={papers} />
    </div>

    <YearLinks allYears={allYears} currentYear={year} />
  </div>
</Layout>
