---
import Layout from "../layouts/Layout.astro";
import PapersTable from "../components/PapersTable.astro";
import YearLinks from "../components/YearLinks.astro";
import {
  loadPapers,
  loadOrganizations,
  loadMeetings,
  getAllAvailableYears,
  getRelevantYear,
} from "../shared/data";
import { buildFilterData } from "../shared/paper-filter-utils";

export async function getStaticPaths() {
  const allYears = await getAllAvailableYears();
  return allYears.map((year) => ({ params: { year } }));
}

const { year } = Astro.params;
const [allPapers, allYears, orgsMap, meetingsMap] = await Promise.all([
  loadPapers(),
  getAllAvailableYears(),
  loadOrganizations(),
  loadMeetings(),
]);
const papers = allPapers.filter((p) => getRelevantYear(p) === year);
const { filterData, filterOptions } = buildFilterData(
  papers,
  orgsMap,
  meetingsMap,
);
---

<Layout>
  <div class="vorlagen-page">
    <h1 class="page-header">Vorlagen {year}</h1>

    <YearLinks allYears={allYears} currentYear={year} />

    <div data-pagefind-ignore>
      <PapersTable
        papers={papers}
        filterData={filterData}
        filterOptions={filterOptions}
      />
    </div>
  </div>
</Layout>

<style>
  .vorlagen-page {
    max-width: 1400px;
    margin: 0 auto;
  }
</style>
