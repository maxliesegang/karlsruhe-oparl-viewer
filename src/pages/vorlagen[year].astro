---
import Layout from "../layouts/Layout.astro";
import PaperListingPage from "../components/PaperListingPage.astro";
import YearLinks from "../components/YearLinks.astro";
import {
  loadPapers,
  loadOrganizations,
  loadMeetings,
  getAllAvailableYears,
  getRelevantYear,
} from "../shared/data";
import { buildFilterData } from "../shared/paper-filter-utils";

export async function getStaticPaths() {
  const allYears = await getAllAvailableYears();
  return allYears.map((year) => ({ params: { year } }));
}

const { year } = Astro.params;
const [allPapers, allYears, orgsMap, meetingsMap] = await Promise.all([
  loadPapers(),
  getAllAvailableYears(),
  loadOrganizations(),
  loadMeetings(),
]);
const papers = allPapers.filter((p) => getRelevantYear(p) === year);
const { filterData, filterOptions } = buildFilterData(
  papers,
  orgsMap,
  meetingsMap,
);
---

<Layout>
  <PaperListingPage
    title={`Vorlagen ${year}`}
    papers={papers}
    filterData={filterData}
    filterOptions={filterOptions}
  >
    <YearLinks slot="intro" allYears={allYears} currentYear={year} />
  </PaperListingPage>
</Layout>
