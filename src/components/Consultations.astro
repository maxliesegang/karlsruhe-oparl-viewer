---
import type { ResolvedConsultation } from "../shared/types";
import { formatDateShort } from "../shared/utils";

interface Props {
  resolvedConsultations: ResolvedConsultation[];
}

const { resolvedConsultations } = Astro.props;
---

<section class="consultations">
  <h2 class="section-heading">Beratungen</h2>
  {
    resolvedConsultations.length > 0 ? (
      <ul class="consultation-list">
        {resolvedConsultations.map(({ consultation, meeting, agendaItem }) => {
          if (!meeting || !agendaItem) return;

          const meetingServerId = meeting.id.split("/").pop();
          const itemLink = `https://sitzungskalender.karlsruhe.de/db/ratsinformation/termin-${meetingServerId}#top${agendaItem.number}`;

          return (
            <li
              class:list={[
                "consultation-item",
                new Date(meeting.start) < new Date()
                  ? "past-meeting"
                  : "upcoming-meeting",
              ]}
            >
              <div class="consultation-info">
                <strong>{meeting.name}</strong>
                <p>Datum: {formatDateShort(meeting.start)}</p>
                <a href={itemLink} target="_blank" rel="noopener noreferrer">
                  <p>TOP: {agendaItem.number || "Keine Angabe"}</p>
                </a>
                <p>Rolle: {consultation.role || "Nicht verfügbar"}</p>
                <p>Ergebnis: {agendaItem.result || "Keine Angabe"}</p>
              </div>
            </li>
          );
        })}
      </ul>
    ) : (
      <p class="no-consultations-msg">Keine Beratungen verfügbar.</p>
    )
  }
</section>

<style>
  .consultations {
    margin-top: 20px;
    padding: 20px;
    background: white;
  }

  .consultation-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .consultation-item {
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid var(--color-border);
    border-radius: var(--radius);
    background: var(--color-bg-card);
  }

  .consultation-item.past-meeting {
    opacity: 0.7;
  }

  .consultation-item.upcoming-meeting {
    border-color: var(--color-link);
  }

  .consultation-info {
    font-size: 0.95rem;
    color: var(--color-text-muted);
  }

  .consultation-info p {
    margin: 5px 0;
  }

  .no-consultations-msg {
    color: #888;
    font-style: italic;
  }
</style>
